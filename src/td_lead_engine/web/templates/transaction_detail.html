{% extends "base.html" %}

{% block title %}Transaction - {{ transaction.property_address }}{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <a href="{{ url_for('transactions_list') }}" class="text-muted text-decoration-none mb-2 d-inline-block">
            <i class="bi bi-arrow-left"></i> Back to Transactions
        </a>
        <h1 class="mb-0">{{ transaction.property_address }}</h1>
    </div>
    <div>
        <button class="btn btn-outline-primary me-2">
            <i class="bi bi-file-earmark"></i> Documents
        </button>
        <button class="btn btn-primary">
            <i class="bi bi-pencil"></i> Edit
        </button>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <!-- Transaction Details -->
        <div class="card border-0 shadow-sm mb-4" style="border-radius: 12px;">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">STATUS</label>
                        <div>
                            <span class="badge bg-{{ 'success' if transaction.status.value == 'closed' else 'warning' }} fs-6">
                                {{ transaction.status.value|title|replace('_', ' ') }}
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">SIDE</label>
                        <div class="fs-5">{{ transaction.side.value|title }}</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">CLIENT</label>
                        <div class="fs-5">{{ transaction.client_name }}</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">PROPERTY</label>
                        <div>{{ transaction.property_address }}</div>
                        <div class="text-muted">{{ transaction.property_city }}, {{ transaction.property_state }}</div>
                    </div>
                </div>

                <hr>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">LIST PRICE</label>
                        <div class="fs-4 fw-bold">${{ '{:,.0f}'.format(transaction.list_price or 0) }}</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">SALE PRICE</label>
                        <div class="fs-4 fw-bold">${{ '{:,.0f}'.format(transaction.sale_price or 0) }}</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">COMMISSION</label>
                        <div class="fs-4 fw-bold text-success">${{ '{:,.0f}'.format(transaction.commission_amount or 0) }}</div>
                    </div>
                </div>

                <hr>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">CONTRACT DATE</label>
                        <div>{{ transaction.contract_date.strftime('%b %d, %Y') if transaction.contract_date else '-' }}</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">CLOSING DATE</label>
                        <div>{{ transaction.closing_date.strftime('%b %d, %Y') if transaction.closing_date else '-' }}</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="text-muted" style="font-size: 0.75rem;">DAYS IN TRANSACTION</label>
                        <div>{{ transaction.days_in_transaction or '-' }} days</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Milestones -->
        <div class="card border-0 shadow-sm" style="border-radius: 12px;">
            <div class="card-header bg-white border-0 pt-3">
                <h6 class="mb-0"><i class="bi bi-flag me-2"></i>Milestones</h6>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-success text-white rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-check"></i>
                            </div>
                        </div>
                        <div>
                            <div class="fw-semibold">Contract Signed</div>
                            <div class="text-muted" style="font-size: 0.75rem;">{{ transaction.contract_date.strftime('%b %d, %Y') if transaction.contract_date else 'Pending' }}</div>
                        </div>
                    </div>
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-{{ 'success' if transaction.inspection_complete else 'light' }} text-{{ 'white' if transaction.inspection_complete else 'muted' }} rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-{{ 'check' if transaction.inspection_complete else 'circle' }}"></i>
                            </div>
                        </div>
                        <div>
                            <div class="fw-semibold">Inspection Complete</div>
                            <div class="text-muted" style="font-size: 0.75rem;">{{ 'Completed' if transaction.inspection_complete else 'Pending' }}</div>
                        </div>
                    </div>
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-light text-muted rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-circle"></i>
                            </div>
                        </div>
                        <div>
                            <div class="fw-semibold">Appraisal Complete</div>
                            <div class="text-muted" style="font-size: 0.75rem;">Pending</div>
                        </div>
                    </div>
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-light text-muted rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-circle"></i>
                            </div>
                        </div>
                        <div>
                            <div class="fw-semibold">Clear to Close</div>
                            <div class="text-muted" style="font-size: 0.75rem;">Pending</div>
                        </div>
                    </div>
                    <div class="d-flex">
                        <div class="me-3">
                            <div class="bg-{{ 'success' if transaction.status.value == 'closed' else 'light' }} text-{{ 'white' if transaction.status.value == 'closed' else 'muted' }} rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-{{ 'check' if transaction.status.value == 'closed' else 'circle' }}"></i>
                            </div>
                        </div>
                        <div>
                            <div class="fw-semibold">Closing</div>
                            <div class="text-muted" style="font-size: 0.75rem;">{{ transaction.closing_date.strftime('%b %d, %Y') if transaction.closing_date else 'Scheduled' }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- Quick Actions -->
        <div class="card border-0 shadow-sm mb-4" style="border-radius: 12px;">
            <div class="card-body">
                <h6 class="mb-3">Quick Actions</h6>
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary text-start">
                        <i class="bi bi-file-earmark-plus me-2"></i> Upload Document
                    </button>
                    <button class="btn btn-outline-primary text-start">
                        <i class="bi bi-calendar-check me-2"></i> Update Milestone
                    </button>
                    <button class="btn btn-outline-primary text-start">
                        <i class="bi bi-calculator me-2"></i> Commission Calculator
                    </button>
                    <button class="btn btn-outline-primary text-start">
                        <i class="bi bi-star me-2"></i> Request Review
                    </button>
                </div>
            </div>
        </div>

        <!-- Parties -->
        <div class="card border-0 shadow-sm" style="border-radius: 12px;">
            <div class="card-header bg-white border-0 pt-3">
                <h6 class="mb-0">Parties</h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="text-muted" style="font-size: 0.7rem;">{{ 'BUYER' if transaction.side.value == 'buyer' else 'SELLER' }}</label>
                    <div class="fw-semibold">{{ transaction.client_name }}</div>
                    <div class="text-muted" style="font-size: 0.875rem;">{{ transaction.client_email or '-' }}</div>
                </div>
                <div class="mb-3">
                    <label class="text-muted" style="font-size: 0.7rem;">LENDER</label>
                    <div>{{ transaction.lender_name or '-' }}</div>
                </div>
                <div class="mb-3">
                    <label class="text-muted" style="font-size: 0.7rem;">TITLE COMPANY</label>
                    <div>{{ transaction.title_company or '-' }}</div>
                </div>
                <div>
                    <label class="text-muted" style="font-size: 0.7rem;">OTHER AGENT</label>
                    <div>{{ transaction.other_agent_name or '-' }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
